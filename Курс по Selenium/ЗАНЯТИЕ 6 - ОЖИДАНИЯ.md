ЗАНЯТИЕ 6 - ОЖИДАНИЯ
Запись занятия
Введение
Неявные ожидания
Явные ожидания
Ожидаемые условия

Кастомные сообщения об ошибке

Домашнее задание


Введение
У WebDriver есть проблема, заключается она в том, что он не может отслеживать изменения в DOM в реальном времени, т.е любые изменения (текст, появления элементов, изменение размеров, исчезновения элементов и прочее) нужно запрашивать самому.

Для этого были созданы два вида ожиданий, явные и неявные.



Неявные ожидания - Implicit wait
Неявное ожидание - это количество времени (которое указывается нами) в течение которого, WebDriver будет опрашивать DOM. Неявным оно называется, так как мы не указываем чего ждать, изменения текста, размера и т.д…

А как мы знаем, появление элемента в DOM, не значит, что он появился визуально, т.е обладает высотой, шириной и т.д в общем пользователь его может и не видеть.

Важно знать:

➖ Указывается 1 раз в коде и работает для всей сессии.
➖ В основном применяется для find_element() и find_elements(), потому что как раз эти методы запрашивают обновления элемента на странице.
➖ При проверке на исчезновение элемента будет задерживать наши тесты.

В коде, неявное ожидание объявляется следующим образом:
driver.implicitly_wait(10)
Цифра 10 - это время в секундах, в течение которого WebDriver опрашивать страницу на наличие элемента.

Пример:
driver.implicitly_wait(3)
driver.get("https://demoqa.com/dynamic-properties")

VISIBLE_AFTER_5_SECOND_BUTTON = ("xpath", "//button[@id='visibleAfter']")
driver.find_element(*VISIBLE_AFTER_5_SECOND_BUTTON).click()
Тк вот в этом примере, будет ошибка, так как в течение 3-х секунд будет производиться попытка кликнуть на элемент, но элемент появляется только через 5 секунд.

В заключении: лично я не рекомендую использовать неявные ожидания, нужно знать что это и для чего, но все же лучше использовать явные ожидания.



Явные ожидания - Explicit wait
Явное ожидание - ожидание конкретного условия, появления элемента, исчезновения элемента, изменения текста и т.д. Вот с этим как раз, работается в разы комфортнее.

Особенности:
➖ Обьявляется только там где нужно
➖ Ожидает выполнения нужного условия
➖ Проверка на отсутствие элемента, может быть условием к завершению теста, так как можно проверить, что элемент пропал и сразу завершить тест, а не ждать лишние 10 секунд.


Для начала работы необходимо импортировать 2 модуля:
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
WebDriverWait - нужен для того, чтобы мы могли указать общее время ожидания для всех условий в будущем.

expected_conditions - в дальнейшем EC, так и переводиться “ожидаемые условия”, т.е данный модуль поможет нам выбрать необходимое условие выполнения которого мы будем ожидать.

Давайте рассмотрим пример кода, где создается обьект wait:
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

service = Service(ChromeDriverManager().install())
driver = webdriver.Chrome(service=service, options=options)

wait = WebDriverWait(driver, 30, poll_frequency=1)
В коде мы видим, что в обьект WebDriverWait прокидываются 3 аргумента

➖ driver - Ну понятное дело, он же ждать то будет)
➖ 30 (любое число) - это количество секунд, в течение которого драйвер будет ждать выполнения того или иного условия
➖ poll_frequency=1 - определяет то, как часто делать новый запрос на проверку выполнения ожидаемого условия. В данном случае 1 секунда.



Ожидаемые условия - Expected conditions
Существует множество условий для ожидания, я дам вам несколько самых частых и нужных, вероятно что другие вам и не понадобятся. Но в первую очередь, давайте разберемся с синтаксисом.
wait.until(EC.условие(локатор)) = жди.пока_не_выполниться_условие(список_условий.условие(локатор))
То есть мы обращаемся к обьекту wait (жди), затем используем until (пока не выолнится), далее EC.условие (условие для элемента).

Ничего сложного, да длинная конструкция, но если разобрать, то все просто и переводя с английского очень даже запоминается.

Но что очень важно знать, тк это в каком виде мы передаем локатор в условия ожидания!

Важно: Условия принимают в себя не распакованный картеж!
BUTTON = ("xpath", "//button[@id='example']")

wait.until(EC.условие(BUTTON))
Обратите внимание, тут мы не используем распаковщик *, как мы это делали к примеру в методе find_element(), потому что если вы провалитесь внутрь какого-нибудь условия, то увидите, что там уже есть встроенная распаковка.



![Alt Pikcher](https://thumb.tildacdn.com/tild6237-3762-4935-b264-616435396238/-/format/webp/image.png)
